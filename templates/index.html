<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chinese-Georgian Convertor</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }
      body {
        background-color: #f8f9fa;
        padding: 10px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .container {
        max-width: 100%;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        flex: 1;
        margin-bottom: 10px;
      }
      .title {
        text-align: center;
        margin-bottom: 15px;
        color: #333;
        font-size: 1.5rem;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        font-size: 0.9rem;
        margin-bottom: 5px;
      }
      .result-box {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        min-height: 150px;
        margin-top: 15px;
        overflow-y: auto;
        max-height: 300px;
      }
      .result-box h4 {
        font-size: 1.1rem;
        margin-bottom: 10px;
      }
      .loading {
        display: none;
        text-align: center;
        margin: 10px 0;
      }
      .btn {
        padding: 8px 16px;
        font-size: 0.9rem;
      }
      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }
        .title {
          font-size: 1.3rem;
          margin-bottom: 10px;
        }
        .form-group {
          margin-bottom: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="title">·É©·Éò·Éú·É£·É†-·É•·Éê·É†·Éó·É£·Éö·Éò ·Éô·Éù·Éú·Éï·Éî·É†·É¢·Éù·É†·Éò</h1>

      <div class="form-group">
        <label for="modeSelect">·É†·Éî·Éü·Éò·Éõ·Éò / Mode:</label>
        <select
          id="modeSelect"
          class="form-select form-select-sm"
          onchange="toggleInputMode()"
        >
          <option value="chinese">Chinese</option>
          <option value="pinyin">Pinyin</option>
        </select>
      </div>

      <div id="chineseInputs">
        <div class="row g-2">
          <div class="col-md-6">
            <div class="form-group">
              <label for="firstName">·É°·Éê·ÉÆ·Éî·Éö·Éò / First Name:</label>
              <input
                type="text"
                class="form-control form-control-sm"
                id="firstName"
                placeholder=""
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="lastName">·Éí·Éï·Éê·É†·Éò / Last Name:</label>
              <input
                type="text"
                class="form-control form-control-sm"
                id="lastName"
                placeholder=""
              />
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="others">·É°·ÉÆ·Éï·Éê / Others:</label>
          <input
            type="text"
            class="form-control form-control-sm"
            id="others"
            placeholder=""
          />
        </div>
      </div>

      <div id="pinyinInput" style="display: none">
        <div class="row g-2">
          <div class="col-md-6">
            <div class="form-group">
              <label for="firstNamePinyin">·É°·Éê·ÉÆ·Éî·Éö·Éò / First Name:</label>
              <input
                type="text"
                class="form-control form-control-sm"
                id="firstNamePinyin"
                placeholder="e.g. bei"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="lastNamePinyin">·Éí·Éï·Éê·É†·Éò / Last Name:</label>
              <input
                type="text"
                class="form-control form-control-sm"
                id="lastNamePinyin"
                placeholder="e.g. jing"
              />
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="othersPinyin">·É°·ÉÆ·Éï·Éê / Others:</label>
          <input
            type="text"
            class="form-control form-control-sm"
            id="othersPinyin"
            placeholder=""
          />
        </div>
      </div>

      <button class="btn btn-primary w-100" onclick="convert()">
        ·Éô·Éù·Éú·Éï·Éî·É†·É¢·Éê·É™·Éò·Éê
      </button>

      <div class="loading">
        <div
          class="spinner-border spinner-border-sm text-primary"
          role="status"
        >
          <span class="visually-hidden">·Éò·É¢·Éï·Éò·É†·Éó·Éî·Éë·Éê...</span>
        </div>
      </div>

      <div class="result-box" id="result">
        <h4>·É®·Éî·Éì·Éî·Éí·Éò / Result:</h4>
        <div id="resultContent" style="font-size: 0.9rem"></div>
        <div id="pinyinBox" style="margin-top: 10px"></div>
        <button
          id="playPinyinBtn"
          class="btn btn-secondary btn-sm mt-2"
          style="display: none"
          onclick="playPinyin()"
        >
          üîä Play Pronunciation
        </button>
        <div
          id="voiceWarning"
          style="color: #b94a48; font-size: 0.9rem; margin-top: 5px"
        ></div>
      </div>
    </div>

    <script>
      function toggleInputMode() {
        const mode = document.getElementById("modeSelect").value;
        document.getElementById("chineseInputs").style.display =
          mode === "chinese" ? "" : "none";
        document.getElementById("pinyinInput").style.display =
          mode === "pinyin" ? "" : "none";
      }

      function convert() {
        const mode = document.getElementById("modeSelect").value;
        let payload = {};
        if (mode === "chinese") {
          const firstName = document.getElementById("firstName").value;
          const lastName = document.getElementById("lastName").value;
          const others = document.getElementById("others").value;
          payload = {
            mode: "chinese",
            first_name: firstName,
            last_name: lastName,
            others: others,
          };
        } else {
          const firstNamePinyin =
            document.getElementById("firstNamePinyin").value;
          const lastNamePinyin =
            document.getElementById("lastNamePinyin").value;
          const othersPinyin = document.getElementById("othersPinyin").value;
          payload = {
            mode: "pinyin",
            first_name_pinyin: firstNamePinyin,
            last_name_pinyin: lastNamePinyin,
            others_pinyin: othersPinyin,
          };
        }

        document.querySelector(".loading").style.display = "block";
        var resultContentElem = document.getElementById("resultContent");
        if (!resultContentElem) {
          alert("Error: resultContent element not found in HTML.");
          return;
        }
        resultContentElem.innerHTML = "";
        document.getElementById("pinyinBox").innerHTML = "";
        document.getElementById("playPinyinBtn").style.display = "none";
        lastPinyin = null;

        fetch("convert", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        })
          .then((response) => {
            console.log("Response status:", response.status);
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            document.querySelector(".loading").style.display = "none";
            let resultHtml = "";
            if (typeof data === "string") {
              resultHtml = `<p>${data}</p>`;
            } else {
              for (const [key, value] of Object.entries(data)) {
                if (
                  value &&
                  typeof value === "object" &&
                  value.pinyin &&
                  (value.georgian || value["·É•·Éê·É†·Éó·É£·Éö·Éò"])
                ) {
                  resultHtml += `<p><b>pinyin:</b> ${
                    value.pinyin
                  }<br><b>·É•·Éê·É†·Éó·É£·Éö·Éò:</b> ${
                    value.georgian || value["·É•·Éê·É†·Éó·É£·Éö·Éò"]
                  }</p><br>`;
                } else if (key === "georgian_from_pinyin" && value) {
                  resultHtml += `<p><b>·É•·Éê·É†·Éó·É£·Éö·Éò:</b> ${value}</p><br>`;
                }
              }
              if (data["error"]) {
                resultHtml += `<p class=\"text-danger\">${data["error"]}</p>`;
              }
            }
            resultContentElem.innerHTML = resultHtml;
          })
          .catch((error) => {
            console.error("Error:", error);
            document.querySelector(".loading").style.display = "none";
            resultContentElem.innerHTML = `<p class=\"text-danger\" style=\"font-size: 0.9rem;\">Error: ${error.message}</p>`;
            document.getElementById("pinyinBox").innerHTML = "";
            document.getElementById("playPinyinBtn").style.display = "none";
          });
      }
    </script>
  </body>
</html>
